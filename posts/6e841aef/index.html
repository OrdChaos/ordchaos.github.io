<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/icons/icon-512x512-alpha.png"><link rel="icon" href="/img/icons/icon-512x512-alpha.png"><link rel="canonical" href="https://www.ordchaos.com/posts/6e841aef/"><link rel="manifest" href="/manifest.json"><script type="text/javascript" src="/js/jump.js"></script><script>function ranN(e,t){return parseInt(Math.random()*(t-e+1)+e,10)}(async()=>{document.querySelector.bind(document);"serviceWorker"in navigator&&(Number(window.localStorage.getItem("OCXQ_BLOGSW_Set"))<1&&(window.localStorage.setItem("OCXQ_BLOGSW_Set",1),window.stop(),document.write("正在加载，请稍后...")),navigator.serviceWorker.register("/sw.js?time="+ranN(1,8888888888888889e4)).then(async()=>{Number(window.localStorage.getItem("OCXQ_BLOGSW_Set"))<2&&setTimeout(()=>{window.localStorage.setItem("OCXQ_BLOGSW_Set",2),window.location.reload()},500)}).catch(e=>console.error("[OCXQ Blog Helper - SW] Error: "+e)))})()</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#fff"><meta name="author" content="序炁"><meta name="keywords" content="计算机"><meta name="description" content="继续备赛CSP-S，这次解决一下此前让人只有我闻之色变的线段树。 当然，在此之前，先来看看比较简单的分块。"><meta property="og:type" content="article"><meta property="og:title" content="学习笔记——分块、线段树"><meta property="og:url" content="https://www.ordchaos.com/posts/6e841aef/index.html"><meta property="og:site_name" content="序炁的博客"><meta property="og:description" content="继续备赛CSP-S，这次解决一下此前让人只有我闻之色变的线段树。 当然，在此之前，先来看看比较简单的分块。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.ordchaos.com/img/2023/01/557e41f1eba9dab1399774a8ef7e679a.jpg"><meta property="article:published_time" content="2024-08-05T13:08:17.000Z"><meta property="article:modified_time" content="2024-08-05T13:08:17.000Z"><meta property="article:author" content="序炁"><meta property="article:tag" content="计算机"><meta property="article:tag" content="编程"><meta property="article:tag" content="cpp"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://img.ordchaos.com/img/2023/01/557e41f1eba9dab1399774a8ef7e679a.jpg"><title>学习笔记——分块、线段树 - 序炁的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/navbar.css"><link rel="stylesheet" href="/css/notice.css"><link rel="stylesheet" href="/css/iconfont/iconfont.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"www.ordchaos.com",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"#"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:"https://umami.ordchaos.top/script.js",website_id:"677e6c7c-3de6-4a66-970f-1d79412c45e7",domains:null,start_time:"2022-01-01T00:00:00.000Z",token:"jelGbnGg/iMr8plt306B8i0mHFNnIuatR7+t1ec5iCuvJkb9/Xmj2XIcHc7r6llTI3Mw7qb8WbYgrXTnsrLRWVMhodB9+HL2IFko3ElDtQ0dOtcP2h6DBHOuG+imO2yuCqnLbiOtP940Zr/uAMN/5oJgTfZ7+yIgubPzlJLQqT4XdDFzkpTtH2CuLW/aOLINmpsCYw1Ud2DLIuxvnau17ea2NRtNsUCjvXiR3yI+DYSPIpZP0/Cal+xMqiGfbCA1QXzyg6Eq9904oBNR9sdqRnsB6vfv6M1EwhUwnKH+a31LKC3BoVWlRX/A49JK2MpgiPTrrvXTpMrlMNkujPW5lH07ifkJNnXpIQ==",api_server:"https://umami.ordchaos.top"}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async="">if(!Fluid.ctx.dnt){let t=document.createElement("script");t.async=!0,t.src="https://umami.ordchaos.top/script.js",t.setAttribute("data-website-id","677e6c7c-3de6-4a66-970f-1d79412c45e7"),t.setAttribute("data-domains",""),document.head.appendChild(t)}</script><style>body hanla:after{content:' ';display:inline;font-family:inherit;font-size:.45em}html .tag-list-item hanla,html code hanla,html kbd hanla,html pre hanla,html ruby hanla,html samp hanla{display:none}html ol>hanla,html ul>hanla{display:none}</style><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="序炁的博客" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="序炁的博客" type="application/rss+xml">
</head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>序炁的博客</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> <span>文章</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/" target="_self"><span>归档</span> </a><a class="dropdown-item" href="/categories/" target="_self"><span>分类</span> </a><a class="dropdown-item" href="/tags/" target="_self"><span>标签</span></a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-ordchaos-blog-gongnengkaiguan"></i> <span>功能</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/bangumis/" target="_self"><span>追番</span> </a><a class="dropdown-item" href="/talk/" target="_self"><span>说说</span> </a><a class="dropdown-item" href="/leave/" target="_self"><span>留言</span></a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-users"></i> <span>自建服务<hanla></hanla></span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="https://jsd.ordchaos.top" target="_blank" rel="external nofollow noopener noreferrer"><span>JSD<hanla></hanla>镜像</span> </a><a class="dropdown-item" href="https://search.ordchaos.top" target="_blank" rel="external nofollow noopener noreferrer"><span>SearXNG</span> </a><a class="dropdown-item" href="https://umami.ordchaos.top/share/1hMhJpE87sebko14/www.ordchaos.com" target="_blank" rel="external nofollow noopener noreferrer"><span>网站统计</span> </a><a class="dropdown-item" href="https://pan.ordchaos.top" target="_blank" rel="external nofollow noopener noreferrer"><span>云盘</span></a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-link-fill"></i> <span>好朋友们</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/links/" target="_self"><span>友链</span> </a><a class="dropdown-item" href="https://out.ordchaos.com/travellings" target="_blank" rel="external nofollow noopener noreferrer"><span>开往</span> </a><a class="dropdown-item" href="https://out.ordchaos.com/wormhole" target="_blank" rel="external nofollow noopener noreferrer"><span>穿梭虫洞</span> </a><a class="dropdown-item" href="https://out.ordchaos.com/shuttle" target="_blank" rel="external nofollow noopener noreferrer"><span>星球穿梭</span></a></div></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn" title="搜索"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="rss-btn" title="RSS订阅"><a class="nav-link" target="_self" href="/atom.xml"><i class="iconfont icon-rss"></i></a></li><li class="nav-item" id="rand-btn" title="随机前往一篇文章"><a class="nav-link" target="_self" href="javascript:randomPost();"><i class="iconfont icon-ordchaos-blog-Random-outlined"></i></a><script type="text/javascript" src="/js/rand.js"></script></li><li class="nav-item" id="chinese-btn" title="繁简体转换"><a class="nav-link" id="StranLink" href="javascript:AutoHan_StranBody()">语<hanla></hanla></a><script type="text/javascript" src="/js/tw_cn_tran.js"></script></li></ul></div></div></nav><script>function supportsFormat(A){return new Promise(e=>{const t=new Image;"avif"===A?t.src="data:image/avif;base64,AAAAGGZ0eXBhdmlmAAAAAG1pZjFtaWFmAAABaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAAAAAAAAAAAAAAAAAAAAADnBpdG0AAAAAAAEAAAAsaWxvYwAAAABEAAACAAEAAAABAAACGQAABDYAAgAAAAEAAAGIAAAAkQAAADhpaW5mAAAAAAACAAAAFWluZmUCAAAAAAEAAGF2MDEAAAAAFWluZmUCAAAAAAIAAGF2MDEAAAAAGmlyZWYAAAAAAAAADmF1eGwAAgABAAEAAACvaXBycAAAAIppcGNvAAAAFGlzcGUAAAAAAAAAgwAAACoAAAAMYXYxQ4E/AAAAAAAQcGl4aQAAAAADCAgIAAAADGF2MUOBHxwAAAAADnBpeGkAAAAAAQgAAAA4YXV4QwAAAAB1cm46bXBlZzptcGVnQjpjaWNwOnN5c3RlbXM6YXV4aWxpYXJ5OmFscGhhAAAAAB1pcG1hAAAAAAAAAAIAAQMBggMAAgQBhAYFAAAEz21kYXQSAAoGH91gqS1QMoQBZGcU/6A/8BDIAAAAAAAAYAAIsD6eEQkNtGxx5qqP59QhmHLxoVbXh166LM7V8Gcmz5bafMxct83KiLUapydWB5o2zRdgDqz2OQlzTK+lel0KFZym9aGt9/kAVFNtKRgZMMRGUAQj0Yk8suEuhdPRdgg+aoDffJ9Ipm+1snFCk/kTQQ6wEgAKCT/dYKktAQ0G0DKmCGTvHaCQift+oB/QCBAAAAAAAADDwAQQQRVgCBlNhvHNkpgKnYhxE46jXXyQPn2kRdH/rT1i30thU6QOOT+0CYFDsVo/6do63cxl+WWFKFb8REtYt1zsKpyBeqD2zP5gkbe/LfXS6wepnZSaxts1kwbtXoKuLdXdtaM9JHt/EMUqnDj9qP2F7dkyxTq+RaX3eM+V0ex3v/0Np+EJ7jyH73GLcQBLct6lDrwvid6vhOkgAYYgoXKvoIQtKw6Wmqs8wXSw5aMOqz4hVailCSKmClZ3kEFTmy2LjK83PFGtupXq4CvKqfj1eMuCMmXnPXTjgdZA1L8kzQqVXhpvpcYudbdzRPJkqRfQY6tgAuKfCr+zCUq1OLwuEEyAtC0grByLXKS9Is+qoZbTP8ZQM6TcZDtVtBE0j/hEpjr5/6ujaORFS2DeO4o9s+NR/5x0j8WzmRUAK31wssDWV/0aT6Q9+8IKkSOG87gTRuOkW7h2XKCs+k+NqDTKw0n8loism8ahfCDnVqrOeZn+yHMTVQJOl3Dzr+ktztZe5o8pzZ086FrGwNwE56Hz0VL5wvqawCDqIpL81C/aN53+5Odq0d+Bk9eetvxMNMkO/iaVL4oPEh9dJZYBq4kMZ+KdV7YK+eEx5fZX7MgdfeIwALLQlp5ivXrySFuNhKY3joRet/RvoiShIQa6rscM7LGQD6A6kc2XgqsLed5WPO+qBrooBfdbkyUndNxG06kWplHU7dHjEfiuY9HilCTFTSWv6LI8IHz5RtXP1hQQFlFOh9d/T894DYaMmVlef//1qQnA/5+TuT88leopUZ0WjasEJnhRmfAIOiHgLELD0QZmqtEQ6K0QE7Wdau4Yt+K2t4h1GV4RHSeGkSJZAeO2q76RLrsRv7RczXTagMT9wqkuTkwZEmFdDvNJS7kiQeMN0iz9Q6QxDVNn7jw3BJW8lhr1Ldg1iHaMqoFlXX2DJDYudTBkNKSMBkLMyaJh2u7uI1SLkWmCNC3ExzJ0awGhnLjS07rWLqM7MVbx30BFhBYJx3OmlboGh5uokBb51FS68CGr6SQMxk/ta8eGp/DXXtvoHQf+Gh/N4BV2r0X9Ix+HIK4xPy05ykD5U2ElJA/B2Ny8464FvS9OT2UpwDVHHWLodEtQfCIUwb2tn5MD8JI7d48aohxDWsoYPecwcA9ruavFgUF/yu5zIXZoQUNgEEPZCcmGZQYdzHv/DnrL7St977bCgmWP6H4pNYOvBpya+G0WM/GGPG+UEDLtqz3nzTf/57mlEwuWsGlQKVHXr58uBNPW3oB7wC5Y5bORXUZejVqTdQGi38YZ/zlMesxlMHIP67oLh/aAjlU3E8Xo0rx5Pa0y+oJkzKU9DfS8VfpACvm//OQBwWO3W2y2zjYtQj6pbK2S9AWtKeXPrMcDMA==":"webp"===A&&(t.src="data:image/webp;base64,UklGRm4HAABXRUJQVlA4WAoAAAAQAAAAggAAKQAAQUxQSHEAAAABYI1te5YXYQhDCSGEEDJoBvsMyiSEEIbwIfTf2fecdV0RMQF7zL7WXh+Durcpx7fvbQCw75XAPhPYK4F9JOAJwF4IeAKwdwSMwEbACfynOoGNgBHoCCQHoEIgOQCNBGQEtBCQEdDQACiXFp+k3lYPCgBWUDgg1gYAAJAjAJ0BKoMAKgA+USKORiOhoSEl9mugcAoJaQAVw72e/1D8a/OvwL98vYTc4/2vyGfUr6/+V/9h/b3hVfUC/EP5B/TvyC/pXDMy3eoF6p/Kf7j+Zf+G8+/+O9APqR6Dv51/bvy3/rHqgeJ94N9oH0Afyf+bf33+0ft9/sPo7/ev9p/hPzA9oP5t/Y/+N/efgC/jX83/zv90/eL+8////7eQj9kvY6/WtfdK+up78UOAxLB9ulKua6Xf32CJnlVZulXVj54Cm+Iy92Sv+z2/OUTOyyVHylB8UmwzsGvXpARF4G2sI03k94e++YGKa+eMkVvG/DHqqmxzG6Zaobj33vv+bHW2P0G6e0nZ7QmKfVRgn0K024GK0yuxA0ySIEqJBx92iPAAAPrd/Ovf45r2t1/hRvt/Zf2HQ+uzLIYhR2x+4v34pzyOfubOBLV2Utb5KqpIXEE2riCtZWlzOCj4iOoebL69i9WtonymhHFx3Pdw9e5/Lfbk9NQqVtstqDAhexzT8r0xgLeDpcNpeUmYCrXGJeeVSY6kEJ3Fej0kYleNzs53NEaJ23xY+AUlhOWFMOpIwyY8GowM2wTyD9E8K6X0y9iPBsFAxP+LLMb1c3XImYKeqxiTHVnQvp8rT+aRF670d6GhmykAAyZKLZlXVpferHbsfUu2x9KZs9f1M4CrOZ5329Jzu2GL+TqlmuqjPQ5ZuvV8/9jHa4iMxTn7n1fxN8F/EBhzEGm83JDlDxuS/baTB1C1VQtDANxZSEVXRs70nk6hdic9901eju0gN/eCsaFNW1IcB4cBhNNJAV8YZ5NBn2Vbi3sCdrlIEZN/fRRfy1l5e8vuifY313CjkALd68wJ799l6Dp73AKKw/NsE3dnMzj6/54G/S/yJNkymblGYVQ2vyvz7e59MLILAfydtr/q6VRlXmCJvcLqFU4g5J+WJHRHDA8Thf/naE49m+jWM6gX3+6RqiMXBMVd2YCCbEZkHhLI/qi2PNk9td7BgGDZ8ukW/x0UX/hieEIAxZy9j2dcRFotT+uvr9xmBwyKVMBAxVBTsQm87ISIzG21lGrfL3gZkaB3tnTX71K8b8sQ+gtDX/ZmlMkwHqnbGqYY+xXoFWzu2ZYPCxf71WAlLMWg4zineFQF+IdJEfA2H9RrMjHSqeFMqKtE1/u0IJFmBu9788flONgd8CsEunEBxfneNC/LdglnjhrzcVlW5NI7CqZhrgUTNCFDaB7BNf2aLWPYiG/d8IWUFbbVxJ78b1pVXO0M/L1q+fI9GIzp17Rvpwhu8KxS524A3Ks30DoJWs05Bm39qTc9pbWGVMyMHu9fiFHM4CNPTL9BBL3my5tOcK7c9lWju4gNA5y+XWlTgCcMgtBKesiifHqPpIImiAa3q4BCTPF2MoQI5CJJz2FVobifNrkYtz8qNOGA1iMqJkq56aRgA5DS+uiUdbcMV9vYgmNMGnu3ti59shldaY70fI+L5OuLwUKmTnGOQFHvi/ZbHNcZ4SOvjgEIhdciiuxqLR9tEzHyk4toG5KnQenSinvsXTpWhpKMBXvEZ1KI2NRB428NaJevAYvG6kVKrEyqBsxAcfciepAIspFVURJ1ziZjKt67qbWanS6MurtSfW93d0vZ+0OkK27/wwrVXWC4ppq0swmjP2DhQHAFqs8lAR7FlZpbQTQw9Ar6gjVah9n5TDd3y4oZQiudVEekbLbtTQxAj5yafsT5KoaqKek9KH81DdJF35ASV1l+QZSPqgMWDlnL1DeDqJc0EZQBgCTAwEK7mssNuG5EWKTeIpoBNuDDFLyepwc4eFP9jkfel+IfXD/5rg0MP7tnP4hjWi/o/7ox48nbeyVNdb4dZ/px6Z6hA61eVKHzs22hXvlnJNLf+Wiim/6LEcx2gOTw0LTDb0BcOQtIXtbOF7KF4Rmrl8doc/10UOZEqjbflMsh4HG9cwexPCV/SmWG7Kj7tBt03KQs4bmF2/WAJIT/oofKeXN2kR//+TPNHIT4/9qDo2NhQGm4ppGE7GfgOr3oyb79PwPN2NPfP4P+HyQwCqwMiA+u//0g80hGqqoKID8nvuIcXe+ysaufo1rKcene3qotEF7/nMUsns7hpgBBypc1fmYtWQA7HEegqUX3JW+v6qvv5+eMiRB8lusGc2U9/8tCCvfDC80FKYSr61Uje+HBcdLVtZIsdZIICEAPA+hO7RqW6bXGOEeyJR5L7XwikPTb7tjKzZPhjl6dymb/OwOfkpyFUNojUAfzjfPPGcstztAE4hyoPFdX4hF6qNnkvapQ268nZlF4ENtUglfsBAUCXzKDbv3ApSjJ6ALpMNbkL8AAAAA="),t.onload=()=>e(!0),t.onerror=()=>e(!1)})}function setCookie(A,e,t){const o=new Date;o.setTime(o.getTime()+24*t*60*60*1e3);const n="expires="+o.toUTCString();document.cookie=A+"="+e+";"+n+";path=/"}function getCookie(A){const e=A+"=",t=document.cookie.split(";");for(let A=0;A<t.length;A++){let o=t[A];for(;" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e))return o.substring(e.length,o.length)}return null}document.addEventListener("DOMContentLoaded",(function(){const A=document.getElementById("banner"),e="https://www.ordchaos.com/img/back",t=getCookie("imageFormatSupport");t?(A.style.backgroundImage=`url('${e}.${t}')`,console.log("[OCXQ Blog Helper] Using cached format support: "+t)):supportsFormat("avif").then(t=>{t?(A.style.backgroundImage=`url('${e}.avif')`,setCookie("imageFormatSupport","avif",30),console.log("[OCXQ Blog Helper] Support avif, redirected banner img to "+e+".avif")):supportsFormat("webp").then(t=>{t?(A.style.backgroundImage=`url('${e}.webp')`,setCookie("imageFormatSupport","webp",30),console.log("[OCXQ Blog Helper] Support webp, redirected banner img to "+e+".webp")):(A.style.backgroundImage=`url('${e}.jpg')`,setCookie("imageFormatSupport",".jpg".substring(1),30),console.log("[OCXQ Blog Helper] Unsupport avif neither webp, show origin img: "+e+".jpg"))})}),A.style.backgroundRepeat="no-repeat",A.style.backgroundPosition="center center",A.style.backgroundSize="cover"}))</script><div id="banner" class="banner" parallax="true"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,0)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="学习笔记——分块、线段树"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> 序炁 </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-08-05 13:08" pubdate="">2024<hanla></hanla>年<hanla></hanla>8<hanla></hanla>月<hanla></hanla>5<hanla></hanla>日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.1k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 31 分钟 </span><span id="umami-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="umami-page-views"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">学习笔记——分块、线段树<hanla></hanla></h1><style>i.icon-ordchaos-blog-robot,span.ocxq-ai-title{font-weight:700;font-size:1.2em}span.ocxq-ai-warn{font-weight:700}.ocxq-ai-text.typing::after{content:"_";margin-left:2px;animation:blink .7s infinite}@keyframes blink{50%{opacity:0}}</style><script>let ordchaosGPT_postSelector="#board .post-content .markdown-body",ordchaosGPT_apiurl="https://summary.ordchaos.top/"</script><div class="ocxqntcontainer"><div class="ocxqnt"><span id="memos-t"><i class="iconfont icon-ordchaos-blog-robot"></i><span id="memos-index-space"> </span><span class="ocxq-ai-title">AI<hanla></hanla>摘要</span><br><span class="ocxq-ai-text">加载中...</span><br><span class="ocxq-ai-warn"><hanla></hanla>摘要由<hanla></hanla>AI<hanla></hanla>自动生成，仅供参考！</span></span></div></div><br><div class="markdown-body"><p>继续备赛<hanla></hanla>CSP-S，这次解决一下此前让人<span class="heimu" title="你知道的太多了">只有我</span>闻之色变的线段树。</p><p>当然，在此之前，先来看看比较简单的分块。</p><span id="more"></span><p>不过在此之前，先理一理这两种数据结构（？）的适用范围。</p><p>（注：本文是对于<hanla></hanla><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?url=aHR0cHM6Ly9vaS13aWtpLm9yZy8=">OI WIKI</a><hanla></hanla>即其它内容写作而来的学习笔记，内容可能稍显一致，但绝非抄袭<hanla></hanla>/<hanla></hanla>洗稿等，欢迎对比）</p><h2 id="分块"><a class="markdownIt-Anchor" href="#分块"></a> 分块</h2><p>具体而言，分块并不是数据结构，而是一种思想。</p><p>在一次同时以相同操作处理大量数据时，不单独处理而进行统筹操作，一次性完成处理。</p><p>这使得其可以用于快速计算类似区间和的问题。</p><p>比之线段树其更为简单，当然，随数据量上升而渐进的复杂度就是相应的代价。</p><p>不过在数据量不大时显然分块更能帮助我们快速解决问题。</p><h3 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h3><p>想象我们有一组共<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>个数据，记为<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">x_{n-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.638891em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span>。</p><p>现在，我们希望得到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ a,b \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">b</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>范围内的区间和。</p><p>如果线性存储，那么对于每次询问操作，都需要进行<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">(</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\left( b-a+1 \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">(</span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0">)</span></span></span></span></span><hanla></hanla>次求和，是<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mrow><mo fence="true">(</mo><mi>n</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">O\left( n \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathdefault" style="margin-right:.02778em">O</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">(</span><span class="mord mathdefault">n</span><span class="mclose delimcenter" style="top:0">)</span></span></span></span></span><hanla></hanla>级别的时间复杂度。</p><p>于是开始分块。将数据分为每<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathdefault" style="margin-right:.03588em">y</span></span></span></span><hanla></hanla>个一组，记为<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>z</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">z_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>z</mi><mrow><mfrac><mi>n</mi><mi>y</mi></mfrac><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">z_{\frac{n}{y}-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.91858em;vertical-align:-.4880199999999999em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33408000000000004em"><span style="top:-2.85em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.6915428571428572em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.48288571428571425em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.4880199999999999em"><span></span></span></span></span></span></span></span></span></span>（其中<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mi>i</mi><mi>y</mi></mrow><mrow><mi>i</mi><mi>y</mi><mo>+</mo><mi>y</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">z_i=\sum_{j=iy}^{iy+y-1}{x_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.400382em;vertical-align:-.43581800000000004em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-.0000050000000000050004em">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.964564em"><span style="top:-2.40029em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.05724em">j</span><span class="mrel mtight">=</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.2029000000000005em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.43581800000000004em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.311664em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span></span>）<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="本文内的除法均为整数除法。">[1]</span></a></sup>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mo><munder><mrow><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>y</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo stretchy="true">⏟</mo></munder></mo><msub><mi>z</mi><mn>0</mn></msub></munder><mo separator="true">,</mo><munder><mo><munder><mrow><msub><mi>x</mi><mi>y</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>y</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi></mrow><mo stretchy="true">⏟</mo></munder></mo><mrow><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>2</mn></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></munder><mi mathvariant="normal">.</mi><munder><mo><munder><mrow><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo stretchy="true">⏟</mo></munder></mo><msub><mi>z</mi><mrow><mfrac><mi>n</mi><mi>y</mi></mfrac><mo>−</mo><mn>1</mn></mrow></msub></munder></mrow><annotation encoding="application/x-tex">\underset{z_0}{\underbrace{x_0,x_1,x_2,x_3,...,x_{y-1}}},\underset{z_1,z_2...}{\underbrace{x_y,x_{y+1},.}}.\underset{z_{\frac{n}{y}-1}}{\underbrace{.,x_{n-1}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.517531em;vertical-align:-2.086971em"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.43056000000000005em"><span style="top:-1.4658920000000002em;margin-left:0"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31731428571428577em"><span style="top:-2.357em;margin-left:-.04398em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span><span class="mop"><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.43055999999999994em"><span class="svg-align" style="top:-2.065892em"><span class="pstrut" style="height:3em"></span><span class="stretchy" style="height:.548em;min-width:1.6em"><span class="brace-left" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"></path></svg></span><span class="brace-center" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"></path></svg></span><span class="brace-right" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"></path></svg></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.934108em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.734208em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.43056000000000005em"><span style="top:-1.465892em;margin-left:0"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31731428571428577em"><span style="top:-2.357em;margin-left:-.04398em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31731428571428577em"><span style="top:-2.357em;margin-left:-.04398em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mord mtight">.</span><span class="mord mtight">.</span><span class="mord mtight">.</span></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span><span class="mop"><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.43055999999999994em"><span class="svg-align" style="top:-2.065892em"><span class="pstrut" style="height:3em"></span><span class="stretchy" style="height:.548em;min-width:1.6em"><span class="brace-left" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"></path></svg></span><span class="brace-center" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"></path></svg></span><span class="brace-right" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"></path></svg></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.934108em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.770216em"><span></span></span></span></span></span></span><span class="mord">.</span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.43055999999999983em"><span style="top:-1.543669em;margin-left:0"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3447999999999999em"><span style="top:-2.760828571428571em;margin-left:-.04398em;margin-right:.07142857142857144em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8175600000000001em"><span style="top:-2.468em"><span class="pstrut" style="height:3em"></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.387em"><span class="pstrut" style="height:3em"></span><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.72644em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.7580571428571429em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span><span class="mop"><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.43055999999999994em"><span class="svg-align" style="top:-2.143669em"><span class="pstrut" style="height:3em"></span><span class="stretchy" style="height:.548em;min-width:1.6em"><span class="brace-left" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"></path></svg></span><span class="brace-center" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMidYMin slice"><path d="M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"></path></svg></span><span class="brace-right" style="height:.548em"><svg width="400em" height="0.548em" viewBox="0 0 400000 548" preserveAspectRatio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"></path></svg></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.8563310000000001em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.086971em"><span></span></span></span></span></span></span></span></span></span></span></p><p>此时，对于<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ a,b \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">b</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>的区间和，可以很容易想到求法（一般而言最后一块不会是完整块，不过无伤大雅）：</p><ul><li>若<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>在同一块内，遍历<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>求和。</li><li>若<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>不在同一块内，区间和为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mi>a</mi></mrow><mrow><mfrac><mi>a</mi><mi>y</mi></mfrac><mi>y</mi><mo>+</mo><mi>y</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mfrac><mi>a</mi><mi>y</mi></mfrac><mo>+</mo><mn>1</mn></mrow><mrow><mfrac><mi>b</mi><mi>y</mi></mfrac><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mfrac><mi>b</mi><mi>y</mi></mfrac><mi>y</mi></mrow><mi>b</mi></msubsup><msub><mi>x</mi><mi>i</mi></msub></mrow></mrow><annotation encoding="application/x-tex">\sum_{i=a}^{\frac{a}{y}y+y-1}{x_i}+\sum_{i=\frac{a}{y}+1}^{\frac{b}{y}-1}{z_i+\sum_{i=\frac{b}{y}y}^b{x_i}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.443764em;vertical-align:-.27686399999999994em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-.0000050000000000050004em">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1669em"><span style="top:-2.7231360000000002em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mathdefault mtight">a</span></span></span></span><span style="top:-3.68282em;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.6915428571428572em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.48288571428571425em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.27686399999999994em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.9365699999999997em;vertical-align:-.6377299999999999em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-.0000050000000000050004em">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2988399999999998em"><span style="top:-2.70072em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.6915428571428572em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.48288571428571425em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.68282em;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8800285714285714em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.48288571428571425em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.6373em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-.0000050000000000050004em">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9890079999999999em"><span style="top:-2.70029em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8800285714285714em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.48288571428571425em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.5029em;margin-right:.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.6377299999999999em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></span></span>，即包含了<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>的不完整块与中间的完整块。</li></ul><p>只要在建块的时候进行预处理就可以通过分块节省大量时间（单次操作时间复杂度变为<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mrow><mo fence="true">(</mo><mfrac><mi>n</mi><mi>y</mi></mfrac><mo>+</mo><mi>y</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">O\left( \frac{n}{y}+y \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.80002em;vertical-align:-.65002em"></span><span class="mord mathdefault" style="margin-right:.02778em">O</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.695392em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathdefault" style="margin-right:.03588em">y</span><span class="mclose delimcenter" style="top:0"><span class="delimsizing size2">)</span></span></span></span></span></span>）</p><p>利用基本不等式<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>⩾</mo><mn>2</mn><msqrt><mrow><mi>a</mi><mi>b</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">a+b\geqslant 2\sqrt{ab}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.83111em;vertical-align:-.13667em"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-.10777999999999999em"></span><span class="mord">2</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.93222em"><span class="svg-align" style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord" style="padding-left:.833em"><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span></span></span><span style="top:-2.89222em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="min-width:.853em;height:1.08em"><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.10777999999999999em"><span></span></span></span></span></span></span></span></span>可以得知，当且仅当<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>n</mi><mi>y</mi></mfrac><mo>=</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">\frac{n}{y}=y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1764999999999999em;vertical-align:-.481108em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.695392em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathdefault" style="margin-right:.03588em">y</span></span></span></span><hanla></hanla>时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">(</mo><mfrac><mi>n</mi><mi>y</mi></mfrac><mo>+</mo><mi>y</mi><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\left( \frac{n}{y}+y \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.80002em;vertical-align:-.65002em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.695392em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:.03588em">y</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathdefault" style="margin-right:.03588em">y</span><span class="mclose delimcenter" style="top:0"><span class="delimsizing size2">)</span></span></span></span></span></span><hanla></hanla>取最小值<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><msqrt><mi>n</mi></msqrt></mrow><annotation encoding="application/x-tex">2\sqrt{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-.23972em"></span><span class="mord">2</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8002800000000001em"><span class="svg-align" style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord" style="padding-left:.833em"><span class="mord mathdefault">n</span></span></span><span style="top:-2.76028em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="min-width:.853em;height:1.08em"><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.23972em"><span></span></span></span></span></span></span></span></span>。也就是说，当每个块大小为<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mi>n</mi></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-.23972em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8002800000000001em"><span class="svg-align" style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord" style="padding-left:.833em"><span class="mord mathdefault">n</span></span></span><span style="top:-2.76028em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="min-width:.853em;height:1.08em"><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.23972em"><span></span></span></span></span></span></span></span></span>时，单次操作得到最小时间复杂度<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mrow><mo fence="true">(</mo><msqrt><mi>n</mi></msqrt><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">O\left(\sqrt{n} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.05028em;vertical-align:-.25em"></span><span class="mord mathdefault" style="margin-right:.02778em">O</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8002800000000001em"><span class="svg-align" style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord" style="padding-left:.833em"><span class="mord mathdefault">n</span></span></span><span style="top:-2.76028em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="min-width:.853em;height:1.08em"><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.23972em"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0">)</span></span></span></span></span>。</p><p>于是我们可以尝试开始建块。</p><h3 id="建块"><a class="markdownIt-Anchor" href="#建块"></a> 建块</h3><p>首先，定义数据结构：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">blocks</span> {<br>	vector&lt;T&gt; datas;<br>	vector&lt;T&gt; sums;<br>	<span class="hljs-type">size_t</span> s;<br><br>	<span class="hljs-comment">//...</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>用向量存储数据，用<hanla></hanla><code>s</code><hanla></hanla>来存储每一块的大小。</p><p>然后，建块：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">blocks</span> {<br>	<span class="hljs-comment">//...</span><br>	<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(vector&lt;T&gt; d, <span class="hljs-type">size_t</span> ss)</span> </span>{<br>		<span class="hljs-type">size_t</span> length = d.<span class="hljs-built_in">size</span>();<br>		<br>		datas.<span class="hljs-built_in">clear</span>();<br>		sums.<span class="hljs-built_in">clear</span>();<br>		datas.<span class="hljs-built_in">resize</span>(length);<br>		<br>		T sum = <span class="hljs-number">0</span>;<br>		<span class="hljs-type">size_t</span> cnt = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; length;i++) {<br>			datas[i] = d[i];<br>			sum += d[i];<br>			cnt++;<br>			<span class="hljs-keyword">if</span>(cnt == ss) {<br>				sums.<span class="hljs-built_in">push_back</span>(sum);<br>				cnt = <span class="hljs-number">0</span>;<br>				sum = <span class="hljs-number">0</span>;<br>			}<br>		}<br>		<span class="hljs-keyword">if</span>(cnt != <span class="hljs-number">0</span>) sums.<span class="hljs-built_in">push_back</span>(sum);<br>		<br>		s = ss;<br>	}<br><br>	<span class="hljs-comment">//...</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>在建块时计算每一块的区间和并存储即可（别忘了可能有的不完整块）。</p><p>以及根据由基本不等式得到的结论，块大小<hanla></hanla><code>s</code><hanla></hanla>一般为<hanla></hanla><code>size_t(sqrt(d.size()))</code></p><p><hanla></hanla>对于求区间和操作，依照原理一节所述操作即可。</p><p>如下：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">blocks</span> {<br>	<span class="hljs-comment">//...</span><br><br>    <span class="hljs-keyword">public</span>:<br>        <span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>            <span class="hljs-type">size_t</span> block_begin = begin / s;<br>            <span class="hljs-type">size_t</span> block_end = end / s;<br><br>            T sum = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-comment">//<hanla></hanla>在同一块里吗？</span><br>            <span class="hljs-keyword">if</span>(block_begin == block_end) {<br>                <span class="hljs-comment">//<hanla></hanla>如果在，线性遍历求和即可</span><br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin;i &lt;= end;i++) {<br>                    sum += datas[i];<br>                }<br><br>                <span class="hljs-keyword">return</span> sum;<br>            }<br><br>            <span class="hljs-comment">//<hanla></hanla>如果不在，分别计算左、中、右三部分</span><br>            <span class="hljs-comment">//<hanla></hanla>左</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin;i &lt; (block_begin + <span class="hljs-number">1</span>) * s;i++) {<br>                sum += datas[i];<br>            }<br><br>            <span class="hljs-comment">//<hanla></hanla>右（注意小于等于）</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_end * s;i &lt;= end;i++) {<br>                sum += datas[i];<br>            }<br><br>            <span class="hljs-comment">//<hanla></hanla>中</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_begin + <span class="hljs-number">1</span>;i &lt; block_end;i++) {<br>                sum += sums[i];<br>            }<br><br>            <span class="hljs-keyword">return</span> sum;<br>        }<br><br>	<span class="hljs-comment">//...</span><br>};<br></code></pre></td></tr></tbody></table></figure><h3 id="更改"><a class="markdownIt-Anchor" href="#更改"></a> 更改</h3><p>存入了数据后，我们自然希望能够自由地更改存入的数据。</p><p>对于区间内的修改操作，同样分为两类（以修改区间<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ a,b\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">b</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>为例）：</p><ul><li>若<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>在同一块内，遍历<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>赋值（需要重新计算区间和）。</li><li>若<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>不在同一块内，遍历包含了<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>的两个不完整块赋值（同上），以及修改中间完整块的区间和即可（无需修改数据本身，具体内容如下代码）。</li></ul><p>问题在于，修改了包含数个整块的数据的值以后，计算修改范围内的完整块内的区间和时可能会导致结果未正确更新。此时需要引入新结构：懒惰标记（lazy marker）。</p><p>对每一个块建立懒惰标记，在查询时通过懒惰标记累计增量更新即可。</p><p>所以我们有：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">blocks</span> {<br>	vector&lt;T&gt; datas;<br>	vector&lt;T&gt; sums;<br>	vector&lt;T&gt; lazy_markers; <span class="hljs-comment">//<hanla></hanla>引入懒惰标记</span><br>	<span class="hljs-type">size_t</span> s;<br><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(vector&lt;T&gt; d, <span class="hljs-type">size_t</span> ss)</span> </span>{<br>		<span class="hljs-type">size_t</span> length = d.<span class="hljs-built_in">size</span>();<br>		<br>		datas.<span class="hljs-built_in">clear</span>();<br>		sums.<span class="hljs-built_in">clear</span>();<br>		lazy_markers.<span class="hljs-built_in">clear</span>(); <span class="hljs-comment">//<hanla></hanla>清空懒惰标记</span><br>		datas.<span class="hljs-built_in">resize</span>(length);<br>		<br>		T sum = <span class="hljs-number">0</span>;<br>		<span class="hljs-type">size_t</span> cnt = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; length;i++) {<br>			datas[i] = d[i];<br>			sum += d[i];<br>			cnt++;<br>			<span class="hljs-keyword">if</span>(cnt == ss) {<br>				sums.<span class="hljs-built_in">push_back</span>(sum);<br>				lazy_markers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//<hanla></hanla>与<hanla></hanla>sums<hanla></hanla>一一对应</span><br>				cnt = <span class="hljs-number">0</span>;<br>				sum = <span class="hljs-number">0</span>;<br>			}<br>		}<br>		<span class="hljs-keyword">if</span>(cnt != <span class="hljs-number">0</span>) {<br>			sums.<span class="hljs-built_in">push_back</span>(sum);<br>			lazy_markers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">//<hanla></hanla>同理，与<hanla></hanla>sums<hanla></hanla>一一对应</span><br>		}<br>		<br>		s = ss;<br>	}<br><br>    <span class="hljs-keyword">public</span>:<br>        <span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>            <span class="hljs-type">size_t</span> block_begin = begin / s;<br>            <span class="hljs-type">size_t</span> block_end = end / s;<br><br>            T sum = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-keyword">if</span>(block_begin == block_end) {<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin;i &lt;= end;i++) {<br>                    sum += datas[i] + lazy_marker[block_begin]; <span class="hljs-comment">//<hanla></hanla>增加懒惰标记内的增量</span><br>                }<br><br>                <span class="hljs-keyword">return</span> sum;<br>            }<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin;i &lt; (block_begin + <span class="hljs-number">1</span>) * s;i++) {<br>                sum += datas[i] + lazy_marker[block_begin]; <span class="hljs-comment">//<hanla></hanla>增加懒惰标记内的增量</span><br>            }<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_end * s;i &lt;= end;i++) {<br>                sum += datas[i] + lazy_marker[block_end]; <span class="hljs-comment">//<hanla></hanla>增加懒惰标记内的增量</span><br>            }<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_begin + <span class="hljs-number">1</span>;i &lt; block_end;i++) {<br>                sum += sums[i];<span class="hljs-comment">//<hanla></hanla>区间和已被改变，无需考虑增量</span><br>            }<br><br>            <span class="hljs-keyword">return</span> sum;<br>        }<br><br>	<span class="hljs-comment">//...</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>由此，对于增量，我们可以有：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">blocks</span> {<br>	<span class="hljs-comment">//...</span><br><br>    <span class="hljs-keyword">public</span>:<br>		<span class="hljs-comment">//...</span><br><br>		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end, T value)</span> </span>{<br>            <span class="hljs-comment">//<hanla></hanla>在同一块里吗？</span><br>            <span class="hljs-keyword">if</span>(block_begin == block_end) {<br>                <span class="hljs-comment">//<hanla></hanla>如果在，线性遍历更新即可</span><br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin;i &lt;= end;i++) {<br>                    datas[i] += value;<br>                    sums[block_begin] += value; <span class="hljs-comment">//<hanla></hanla>更新区间和</span><br>                }<br><br>                <span class="hljs-keyword">return</span>;<br>            }<br><br>			<span class="hljs-comment">//<hanla></hanla>如果不在，分别更新左、中、右部分</span><br>			<span class="hljs-comment">//<hanla></hanla>左</span><br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin;i &lt; (block_begin + <span class="hljs-number">1</span>) * s;i++) {<br>				datas[i] += value;<br>				sums[block_begin] += value; <span class="hljs-comment">//<hanla></hanla>更新区间和</span><br>			}<br><br>            <span class="hljs-comment">//<hanla></hanla>右（注意小于等于）</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_end * s;i &lt;= end;i++) {<br>                datas[i] += value;<br>                sums[block_end] += value; <span class="hljs-comment">//<hanla></hanla>更新区间和</span><br>            }<br><br>            <span class="hljs-comment">//<hanla></hanla>中</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_begin + <span class="hljs-number">1</span>;i &lt; block_end;i++) {<br>                sums[i] += value * s; <span class="hljs-comment">//<hanla></hanla>更新区间和</span><br>                lazy_marker[i] += value; <span class="hljs-comment">//<hanla></hanla>更新懒惰标记</span><br>            }<br>		}<br><br>	<span class="hljs-comment">//...</span><br>};<br></code></pre></td></tr></tbody></table></figure><h3 id="比较"><a class="markdownIt-Anchor" href="#比较"></a> 比较</h3><p>当我们希望得到区间最小<hanla></hanla>/<hanla></hanla>最大值时，同样可以采取分块的思想。</p><p>相信根据懒惰标记的方法也能想到，只需要再添加两个向量用于维护区间最小<hanla></hanla>/<hanla></hanla>最大值即可。</p><p>原理仍然一致，这里不重复给出。</p><p>以下是完整的代码：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">blocks</span> {<br>	vector&lt;T&gt; datas;<br>	vector&lt;T&gt; sums;<br>	vector&lt;T&gt; lazy_markers;<br>    vector&lt;T&gt; maxs; <span class="hljs-comment">//<hanla></hanla>维护区间最大值</span><br>    vector&lt;T&gt; mins; <span class="hljs-comment">//<hanla></hanla>维护区间最小值</span><br>	<span class="hljs-type">size_t</span> s;<br><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(vector&lt;T&gt; d, <span class="hljs-type">size_t</span> ss)</span> </span>{<br>		<span class="hljs-type">size_t</span> length = d.<span class="hljs-built_in">size</span>();<br><br>		datas.<span class="hljs-built_in">clear</span>();<br>		sums.<span class="hljs-built_in">clear</span>();<br>		lazy_markers.<span class="hljs-built_in">clear</span>();<br>        maxs.<span class="hljs-built_in">clear</span>();<br>        mins.<span class="hljs-built_in">clear</span>();<br>		datas.<span class="hljs-built_in">resize</span>(length);<br><br>		T sum = <span class="hljs-number">0</span>;<br>		<span class="hljs-type">size_t</span> cnt = <span class="hljs-number">0</span>;<br>        T max_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">min</span>(); <span class="hljs-comment">//<hanla></hanla>当作负无穷</span><br>        T min_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">max</span>(); <span class="hljs-comment">//<hanla></hanla>当作正无穷</span><br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {<br>			datas[i] = d[i];<br>			sum += d[i];<br>            max_val = <span class="hljs-built_in">max</span>(max_val, d[i]);<br>            min_val = <span class="hljs-built_in">min</span>(min_val, d[i]);<br>            cnt++;<br>			<span class="hljs-keyword">if</span>(cnt == ss) {<br>				sums.<span class="hljs-built_in">push_back</span>(sum);<br>				lazy_markers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>);<br>                maxs.<span class="hljs-built_in">push_back</span>(max_val);<br>                mins.<span class="hljs-built_in">push_back</span>(min_val);<br>                max_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">min</span>();<br>                min_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">max</span>();<br>				sum = <span class="hljs-number">0</span>;<br>                cnt = <span class="hljs-number">0</span>;<br>			}<br>		}<br>		<span class="hljs-keyword">if</span>(cnt != <span class="hljs-number">0</span>) {<br>			sums.<span class="hljs-built_in">push_back</span>(sum);<br>			lazy_markers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>);<br>            maxs.<span class="hljs-built_in">push_back</span>(max_val);<br>            mins.<span class="hljs-built_in">push_back</span>(min_val);<br>		}<br><br>		s = ss;<br>	}<br><br>    <span class="hljs-keyword">public</span>:<br>	    <span class="hljs-comment">//<hanla></hanla>构造函数</span><br>        <span class="hljs-built_in">blocks</span>(<span class="hljs-type">const</span> vector&lt;T&gt;&amp; d, <span class="hljs-type">size_t</span> ss) {<br>            <span class="hljs-built_in">build</span>(d, ss);<br>        }<br><br>		<span class="hljs-comment">//query<hanla></hanla>不变</span><br><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end, T value)</span> </span>{<br>            <span class="hljs-type">size_t</span> block_begin = begin / s;<br>            <span class="hljs-type">size_t</span> block_end = end / s;<br><br>            <span class="hljs-comment">//<hanla></hanla>重新计算最大<hanla></hanla>/<hanla></hanla>最小值</span><br>            T max_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">min</span>();<br>            T min_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">max</span>();<br><br>            <span class="hljs-keyword">if</span>(block_begin == block_end) {<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin; i &lt;= end; i++) {<br>                    datas[i] += value;<br>                    sums[block_begin] += value;<br>                    max_val = <span class="hljs-built_in">max</span>(max_val, datas[i]);<br>                    min_val = <span class="hljs-built_in">min</span>(min_val, datas[i]);<br>                }<br>                <span class="hljs-comment">//<hanla></hanla>更新最大<hanla></hanla>/<hanla></hanla>最小值</span><br>                maxs[block_begin] = <span class="hljs-built_in">max</span>(maxs[block_begin], max_val);<br>                mins[block_begin] = <span class="hljs-built_in">min</span>(mins[block_begin], min_val);<br>                <span class="hljs-keyword">return</span>;<br>            }<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin; i &lt; (block_begin + <span class="hljs-number">1</span>) * s; i++) {<br>                datas[i] += value;<br>                sums[block_begin] += value;<br>                max_val = <span class="hljs-built_in">max</span>(max_val, datas[i]);<br>                min_val = <span class="hljs-built_in">min</span>(min_val, datas[i]);<br>            }<br>            maxs[block_begin] = <span class="hljs-built_in">max</span>(maxs[block_begin], max_val);<br>            mins[block_begin] = <span class="hljs-built_in">min</span>(mins[block_begin], min_val);<br><br>            max_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">min</span>();<br>            min_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">max</span>();<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_end * s; i &lt;= end; i++) {<br>                datas[i] += value;<br>                sums[block_end] += value;<br>                max_val = <span class="hljs-built_in">max</span>(max_val, datas[i]);<br>                min_val = <span class="hljs-built_in">min</span>(min_val, datas[i]);<br>            }<br>            maxs[block_end] = <span class="hljs-built_in">max</span>(maxs[block_end], max_val);<br>            mins[block_end] = <span class="hljs-built_in">min</span>(mins[block_end], min_val);<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_begin + <span class="hljs-number">1</span>; i &lt; block_end; i++) {<br>                sums[i] += value * s;<br>                lazy_markers[i] += value;<br>                maxs[i] += value;<br>                mins[i] += value;<br>            }<br>        }<br><br>    <span class="hljs-comment">//<hanla></hanla>与<hanla></hanla>query<hanla></hanla>和<hanla></hanla>update<hanla></hanla>相同的结构：是否在同一块内-&gt;<hanla></hanla>计算，query_min<hanla></hanla>同理</span><br>    <span class="hljs-function">T <span class="hljs-title">query_max</span><span class="hljs-params">(<span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>        <span class="hljs-type">size_t</span> block_begin = begin / s;<br>        <span class="hljs-type">size_t</span> block_end = end / s;<br><br>        T max_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">min</span>();<br><br>        <span class="hljs-keyword">if</span>(block_begin == block_end) {<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin; i &lt;= end; i++) {<br>                max_val = <span class="hljs-built_in">max</span>(max_val, datas[i] + lazy_markers[block_begin]); <span class="hljs-comment">//<hanla></hanla>注意处理懒惰标记的影响，以下同理</span><br>            }<br>            <span class="hljs-keyword">return</span> max_val;<br>        }<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin; i &lt; (block_begin + <span class="hljs-number">1</span>) * s; i++) {<br>            max_val = <span class="hljs-built_in">max</span>(max_val, datas[i] + lazy_markers[block_begin]);<br>        }<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_end * s; i &lt;= end; i++) {<br>            max_val = <span class="hljs-built_in">max</span>(max_val, datas[i] + lazy_markers[block_end]);<br>        }<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_begin + <span class="hljs-number">1</span>; i &lt; block_end; i++) {<br>            max_val = <span class="hljs-built_in">max</span>(max_val, maxs[i]);<br>        }<br><br>        <span class="hljs-keyword">return</span> max_val;<br>    }<br><br>    <span class="hljs-function">T <span class="hljs-title">query_min</span><span class="hljs-params">(<span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>        <span class="hljs-type">size_t</span> block_begin = begin / s;<br>        <span class="hljs-type">size_t</span> block_end = end / s;<br><br>        T min_val = numeric_limits&lt;T&gt;::<span class="hljs-built_in">max</span>();<br><br>        <span class="hljs-keyword">if</span>(block_begin == block_end) {<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin; i &lt;= end; i++) {<br>                min_val = <span class="hljs-built_in">min</span>(min_val, datas[i] + lazy_markers[block_begin]);<br>            }<br>            <span class="hljs-keyword">return</span> min_val;<br>        }<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = begin; i &lt; (block_begin + <span class="hljs-number">1</span>) * s; i++) {<br>            min_val = <span class="hljs-built_in">min</span>(min_val, datas[i] + lazy_markers[block_begin]);<br>        }<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_end * s; i &lt;= end; i++) {<br>            min_val = <span class="hljs-built_in">min</span>(min_val, datas[i] + lazy_markers[block_end]);<br>        }<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = block_begin + <span class="hljs-number">1</span>; i &lt; block_end; i++) {<br>            min_val = <span class="hljs-built_in">min</span>(min_val, mins[i]);<br>        }<br><br>        <span class="hljs-keyword">return</span> min_val;<br>    }<br>};<br></code></pre></td></tr></tbody></table></figure><p>一般而言，不会有题目同时要求进行数据变更、求区间和、求最值。</p><p>如果有，更推荐写线段树，毕竟分块拓展到这种程度也不简单了。</p><p>最后，对于懒惰标记的影响范围：</p><ul><li>赋值时：由<hanla></hanla>update<hanla></hanla>方法确定<strong>区间和</strong>的懒惰标记（datas、maxs、mins；不完整块直接线性增加）。</li><li>使用时：只对<strong>完整区间</strong>内的<hanla></hanla><strong>datas</strong>（换句话说，第三个循环<hanla></hanla>/<hanla></hanla>遍历中间块的循环内的<hanla></hanla>datas）数据增加<strong>该块的懒惰标记</strong>；在<hanla></hanla>query、query_max、query_min<hanla></hanla>内使用。</li></ul><h3 id="例题"><a class="markdownIt-Anchor" href="#例题"></a> 例题</h3><p>如上文，几乎没有同时要求进行数据变更、求区间和、求最值的例题。</p><p>这里随便放一道看看得了。</p><p>题目来自洛谷<hanla></hanla><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?url=aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDE4MTY=">P1816 忠诚</a></p><h4 id="题目描述"><a class="markdownIt-Anchor" href="#题目描述"></a> 题目描述</h4><p>老管家是一个聪明能干的人。他为财主工作了整整<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mord">0</span></span></span></span><hanla></hanla>年。财主为了让自已账目更加清楚，要求管家每天记<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathdefault" style="margin-right:.03148em">k</span></span></span></span><hanla></hanla>次账。由于管家聪明能干，因而管家总是让财主十分满意。但是由于一些人的挑拨，财主还是对管家产生了怀疑。于是他决定用一种特别的方法来判断管家的忠诚，他把每次的账目按<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">1,2,3,...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8388800000000001em;vertical-align:-.19444em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span><hanla></hanla>编号，然后不定时的问管家问题，问题是这样的：在<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">a</span></span></span></span><hanla></hanla>到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathdefault">b</span></span></span></span><hanla></hanla>号账中最少的一笔是多少？为了让管家没时间作假，他总是一次问多个问题。</p><h4 id="输入格式"><a class="markdownIt-Anchor" href="#输入格式"></a> 输入格式</h4><p>输入中第一行有两个数<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>表示有<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">m</span></span></span></span><hanla></hanla>笔账和<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>个问题。</p><p>第二行为<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">m</span></span></span></span><hanla></hanla>个数，分别是账目的钱数。</p><p>后面<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>行分别是<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>个问题，每行有<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span></span></span></span><hanla></hanla>个数字说明开始结束的账目编号。</p><h4 id="输出格式"><a class="markdownIt-Anchor" href="#输出格式"></a> 输出格式</h4><p>在一行中输出每个问题的答案，以一个空格分割。</p><h4 id="输入样例"><a class="markdownIt-Anchor" href="#输入样例"></a> 输入样例<hanla></hanla></h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">10 3<br>1 2 3 4 5 6 7 8 9 10<br>2 7<br>3 9<br>1 10<br></code></pre></td></tr></tbody></table></figure><h4 id="输出样例"><a class="markdownIt-Anchor" href="#输出样例"></a> 输出样例<hanla></hanla></h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">2 3 1<br></code></pre></td></tr></tbody></table></figure><h4 id="题解"><a class="markdownIt-Anchor" href="#题解"></a> 题解</h4><p>上文重复了多遍建块以及各种操作的代码，故而这里只给出<hanla></hanla><code>main</code><hanla></hanla>函数。</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-comment">//blocks<hanla></hanla>相关<hanla></hanla></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-type">int</span> m, n;<br>    cin &gt;&gt; m &gt;&gt; n;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">data</span><span class="hljs-params">(m)</span></span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) {<br>        cin &gt;&gt; data[i];<br>    }<br><br>    <span class="hljs-function">blocks&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">b</span><span class="hljs-params">(data, <span class="hljs-type">size_t</span>(sqrt(data.size())))</span></span>;<br><br>    vector&lt;<span class="hljs-type">int</span>&gt; results;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {<br>        <span class="hljs-type">int</span> a, c;<br>        cin &gt;&gt; a &gt;&gt; c;<br>        results.<span class="hljs-built_in">push_back</span>(b.<span class="hljs-built_in">query_min</span>(a - <span class="hljs-number">1</span>, c - <span class="hljs-number">1</span>));<br>    }<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> result : results) {<br>        cout &lt;&lt; result &lt;&lt; <span class="hljs-string">" "</span>;<br>    }<br>    cout &lt;&lt; endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="补充"><a class="markdownIt-Anchor" href="#补充"></a> 补充</h3><p>再次申明：分块是一种思想而不是数据结构，故而用法绝对不止这些。</p><p>在同时处理大量数据时，不妨考虑一下分块。</p><h2 id="线段树"><a class="markdownIt-Anchor" href="#线段树"></a> 线段树</h2><p>线段树是用来维护区间信息的<strong>数据结构</strong>。</p><p>相比于分块而言，线段树的结构更为细化，可以精确的控制数据的索引范围，而无需对于不完整部分进行遍历。</p><h3 id="原理-2"><a class="markdownIt-Anchor" href="#原理-2"></a> 原理</h3><blockquote><p>线段树将每个长度不为<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span><hanla></hanla>的区间划分成左右两个区间递归求解，把整个线段划分为一个树形结构，通过合并左右两区间信息来求得该区间的信息。这种数据结构可以方便的进行大部分的区间操作。<br>——<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?url=aHR0cHM6Ly9vaS13aWtpLm9yZy9kcy9zZWcv">OI WIKI - 线段树</a></p></blockquote><p>看到这段话之后有没有想起什么？</p><p>没错，是递归。通过递归就可以不断细化每一个左、右子树，直至叶节点为止。</p><h3 id="建树"><a class="markdownIt-Anchor" href="#建树"></a> 建树</h3><p>首先建立数据结构：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SegTree</span> {<br>	vector&lt;T&gt; datas;<br>	vector&lt;T&gt; lazy_markers; <span class="hljs-comment">//<hanla></hanla>懒惰标记，应该没忘记吧</span><br>	<span class="hljs-type">size_t</span> length;<br>};<br></code></pre></td></tr></tbody></table></figure><p>然后考虑递归建树即可：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//<hanla></hanla>是<hanla></hanla>SegTree<hanla></hanla>的成员函数<hanla></hanla></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(vector&lt;T&gt; &amp;d, <span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>	<span class="hljs-keyword">if</span>(begin == end) { <span class="hljs-comment">//<hanla></hanla>是叶节点</span><br>		datas[node] = d[begin];<br>	}<br>	<span class="hljs-keyword">else</span> { <span class="hljs-comment">//<hanla></hanla>不是叶节点</span><br>		<span class="hljs-type">size_t</span> mid = (begin + end) / <span class="hljs-number">2</span>;<br>		<span class="hljs-built_in">build</span>(d, node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, begin, mid);    <span class="hljs-comment">//<hanla></hanla>左子树</span><br>		<span class="hljs-built_in">build</span>(d, node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, mid + <span class="hljs-number">1</span>, end);  <span class="hljs-comment">//<hanla></hanla>右子树</span><br>		datas[node] = datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] + datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>];<br>	}<br>}<br><br><span class="hljs-keyword">public</span>:<br>	<span class="hljs-built_in">SegTree</span>(vector&lt;T&gt; &amp;d) { <span class="hljs-comment">//<hanla></hanla>构造函数</span><br>		datas.<span class="hljs-built_in">clear</span>();<br>		lazy_markers.<span class="hljs-built_in">clear</span>();<br>		length = d.<span class="hljs-built_in">size</span>();<br><br>		datas.<span class="hljs-built_in">resize</span>(length * <span class="hljs-number">4</span>);<br>		lazy_markers.<span class="hljs-built_in">resize</span>(length * <span class="hljs-number">4</span>, <span class="hljs-number">0</span>);<br><br>		<span class="hljs-built_in">build</span>(d, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, length - <span class="hljs-number">1</span>);<br>	}<br></code></pre></td></tr></tbody></table></figure><p><hanla></hanla>可能会有人认为完全二叉树的左右子节点应该是<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding="application/x-tex">2n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>与<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2n+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>，但对于<hanla></hanla><code>0base</code><hanla></hanla>的数组而言，显然<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>0</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">2\times 0=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span><hanla></hanla>代表不了子节点。</p><h3 id="查询区间和"><a class="markdownIt-Anchor" href="#查询区间和"></a> 查询<hanla></hanla>/<hanla></hanla>区间和</h3><p>为何线段树由于分块？答案就在这里。</p><p>来看看这张图（备好草稿纸，照着下面的流程对着图自己想象一下）：</p><p><img src="https://img.ordchaos.com/img/2024/08/79b1b7f18647e1f5596bc89cdfd11b29.png" srcset="/img/loading.gif" lazyload alt=""></p><p>根据<hanla></hanla><code>build</code><hanla></hanla>方法，对<hanla></hanla><code>{1, 2, 3, 4, 5}</code><hanla></hanla>建树，可以得到这样的一棵完全二叉树。</p><p>若我们希望得到<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>b</mi><mo separator="true">,</mo><mi>e</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ b,e\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">e</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>的区间和，流程如下：</p><ul><li><ol><li>将目前区间<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ s,t\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>设置为<strong>整个区间</strong>；</li></ol></li><li><ol start="2"><li>目前区间是<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>b</mi><mo separator="true">,</mo><mi>e</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ b,e\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">e</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>的子区间吗？如果是，返回目前区间的区间和；如果不是且<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>b</mi><mo separator="true">,</mo><mi>e</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ b,e\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">e</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>与目前区间<strong>有交区间</strong>，继续。</li></ol></li><li><ol start="3"><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>i</mi><mi>d</mi><mo>=</mo><mfrac><mrow><mi>s</mi><mo>+</mo><mi>t</mi></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">mid=\frac{s+t}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.169556em;vertical-align:-.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.824556em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，由此将<strong>目前区间</strong>划分为左区间（左子树；右子树同理）<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>s</mi><mo separator="true">,</mo><mi>m</mi><mi>i</mi><mi>d</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ s,mid\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>与右区间<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mi>m</mi><mi>i</mi><mi>d</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[mid+1,t]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">[</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">t</span><span class="mclose">]</span></span></span></span>；</li></ol></li><li><ol start="4"><li>递归查找左区间与右区间，返回左区间返回值与右区间返回值之和。</li></ol></li></ul><p>这样可以方便快速地将待查区间划分为尽可能大的不同区间，而这些区间的区间和已经被储存，就不需要遍历以获取区间和了。</p><p>代码如下：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//<hanla></hanla>是<hanla></hanla>SegTree<hanla></hanla>的成员函数<hanla></hanla></span><br><span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin_now, <span class="hljs-type">size_t</span> end_now, <span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>	<span class="hljs-keyword">if</span>(begin_now &gt; end || end_now &lt; begin) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//<hanla></hanla>不在查找范围内，返回<hanla></hanla>0</span><br>	<span class="hljs-keyword">if</span>(begin_now &gt;= begin &amp;&amp; end_now &lt;= end) <span class="hljs-keyword">return</span> datas[node]; <span class="hljs-comment">//<hanla></hanla>目前区间是目标区间的子区间，返回区间和</span><br><br>	<span class="hljs-type">size_t</span> mid = (begin_now + end_now) / <span class="hljs-number">2</span>;<br>	T left_res = <span class="hljs-built_in">query</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, begin_now, mid, begin, end);       <span class="hljs-comment">//<hanla></hanla>左区间</span><br>	T right_res = <span class="hljs-built_in">query</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, mid + <span class="hljs-number">1</span>, end_now, begin, end);  <span class="hljs-comment">//<hanla></hanla>右区间</span><br>	<span class="hljs-keyword">return</span> left_res + right_res;<br>}<br></code></pre></td></tr></tbody></table></figure><p><hanla></hanla>调用时使用<hanla></hanla><code>this-&gt;query(0, 0, length - 1, b, e)</code><hanla></hanla>即可。</p><h3 id="修改"><a class="markdownIt-Anchor" href="#修改"></a> 修改</h3><p>利用懒惰标记即可，这里的懒惰标记表明<hanla></hanla>“这个区间内的所有元素都应当加上懒惰标记”。</p><p>换句话说，你会发现懒惰标记与线段树的大小与结构一模一样。对于节点<hanla></hanla><code>node</code>，其懒惰标记就存在<hanla></hanla><code>lazy_markers[node]</code><hanla></hanla>里。</p><p>因此流程实际上与求区间和是一模一样的：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//<hanla></hanla>是<hanla></hanla>SegTree<hanla></hanla>的成员函数<hanla></hanla></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin_now, <span class="hljs-type">size_t</span> end_now, <span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end, T value)</span> </span>{<br>	<span class="hljs-keyword">if</span>(begin_now &gt; end || end_now &lt; begin) <span class="hljs-keyword">return</span>;<br>	<span class="hljs-keyword">if</span>(begin_now &gt;= begin &amp;&amp; end_now &lt;= end) {<br>		datas[node] += (end_now - begin_now + <span class="hljs-number">1</span>) * value; <span class="hljs-comment">//<hanla></hanla>区间和增加</span><br>		<span class="hljs-keyword">if</span>(begin_now != end_now) {<br>			lazy_markers[node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] += value; <span class="hljs-comment">//<hanla></hanla>设置左右区间的懒惰标记（即整个区间）</span><br>			lazy_markers[node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>] += value;<br>		}<br>		<span class="hljs-keyword">return</span>;<br>	}<br><br>	<span class="hljs-type">size_t</span> mid = (begin_now + end_now) / <span class="hljs-number">2</span>;<br>	<span class="hljs-built_in">update</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, begin_now, mid, begin, end, value);          <span class="hljs-comment">//<hanla></hanla>左区间</span><br>	<span class="hljs-built_in">update</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, mid + <span class="hljs-number">1</span>, end_now, begin, end, value);      <span class="hljs-comment">//<hanla></hanla>右区间</span><br>	datas[node] = datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] + datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>]; <span class="hljs-comment">//<hanla></hanla>当前区间</span><br>}<br></code></pre></td></tr></tbody></table></figure><p><hanla></hanla>为了应用懒惰标记，我们也需要一个方法，这个方法将当前节点的懒惰标记加载当前节点的值上，然后设置其左右子节点的懒惰标记（<strong>传递懒惰标记</strong>）</p><p>那就写呗：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//<hanla></hanla>是<hanla></hanla>SegTree<hanla></hanla>的成员函数<hanla></hanla></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin_now, <span class="hljs-type">size_t</span> end_now)</span> </span>{ <span class="hljs-comment">//<hanla></hanla>在使用时传递区间大小</span><br>	<span class="hljs-keyword">if</span>(lazy_markers[node] != <span class="hljs-number">0</span>) { <span class="hljs-comment">//<hanla></hanla>需要更新</span><br>		datas[node] += (end_now - begin_now + <span class="hljs-number">1</span>) * lazy_markers[node];<br>		<span class="hljs-keyword">if</span>(begin_now != end_now) { <span class="hljs-comment">//<hanla></hanla>不是叶节点</span><br>			lazy_markers[<span class="hljs-number">2</span> * node + <span class="hljs-number">1</span>] += lazy_markers[node];<br>			lazy_markers[<span class="hljs-number">2</span> * node + <span class="hljs-number">2</span>] += lazy_markers[node];<br>		}<br>		lazy_markers[node] = <span class="hljs-number">0</span>; <span class="hljs-comment">//<hanla></hanla>释放</span><br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p><hanla></hanla>你会发现这个操作是<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">O\left(1 \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathdefault" style="margin-right:.02778em">O</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">(</span><span class="mord">1</span><span class="mclose delimcenter" style="top:0">)</span></span></span></span></span><hanla></hanla>的。</p><p>Without thinking twice，在每次<hanla></hanla><code>query</code><hanla></hanla>与<hanla></hanla><code>update</code><hanla></hanla>以前调用即可。</p><h3 id="比较-2"><a class="markdownIt-Anchor" href="#比较-2"></a> 比较</h3><p>不像分块那么复杂，只需要修改维护<hanla></hanla><code>datas</code><hanla></hanla>的规则，我们就可以轻松进行对最小<hanla></hanla>/<hanla></hanla>最大值的查询。</p><p>当前对<hanla></hanla><code>datas</code><hanla></hanla>的维护规则是：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mrow><mo fence="true">[</mo><mi>i</mi><mo fence="true">]</mo></mrow><mo>=</mo><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mrow><mo fence="true">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo fence="true">]</mo></mrow><mo>+</mo><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mrow><mo fence="true">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">datas\left[i \right]=datas\left[2i+1 \right]+datas\left[2i+2 \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">i</span><span class="mclose delimcenter" style="top:0">]</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord">2</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0">]</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord">2</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">2</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span>，将<hanla></hanla><code>sum</code><hanla></hanla>改为<hanla></hanla><code>min</code><hanla></hanla>或者<hanla></hanla><code>max</code><hanla></hanla>即可得到最值。（懒惰标记的维护不变）</p><p>代码就不放了。</p><h3 id="例题-2"><a class="markdownIt-Anchor" href="#例题-2"></a> 例题</h3><p>来一道模板吧！</p><p>题目来自洛谷<hanla></hanla><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?url=aHR0cHM6Ly93d3cubHVvZ3UuY29tLmNuL3Byb2JsZW0vUDMzNzI=">P3372 【模板】线段树 1</a></p><h4 id="题目描述-2"><a class="markdownIt-Anchor" href="#题目描述-2"></a> 题目描述</h4><p>如题，已知一个数列，你需要进行下面两种操作：</p><ul><li>将某区间每一个数加上<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathdefault" style="margin-right:.03148em">k</span></span></span></span>。</li><li>求出某区间每一个数的和。</li></ul><h4 id="输入格式-2"><a class="markdownIt-Anchor" href="#输入格式-2"></a> 输入格式</h4><p>第一行包含两个整数<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault">n</span></span></span></span>，分别表示该数列数字的个数和操作的总个数。</p><p>第二行包含<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">n</span></span></span></span><hanla></hanla>个用空格分隔的整数，其中第<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathdefault">i</span></span></span></span><hanla></hanla>个数字表示数列第<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathdefault">i</span></span></span></span><hanla></hanla>项的初始值。</p><p>接下来<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathdefault">m</span></span></span></span><hanla></hanla>行每行包含<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">3</span></span></span></span><hanla></hanla>或<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">4</span></span></span></span><hanla></hanla>个整数，表示一个操作，具体如下：</p><ul><li><code>1 x y k</code> 将区间<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ x,y\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault" style="margin-right:.03588em">y</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>内每个数加上<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathdefault" style="margin-right:.03148em">k</span></span></span></span></li><li><code>2 x y</code> 输出区间<hanla></hanla><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[ x,y\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">[</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathdefault" style="margin-right:.03588em">y</span><span class="mclose delimcenter" style="top:0">]</span></span></span></span></span><hanla></hanla>内每个数的和</li></ul><h4 id="输出格式-2"><a class="markdownIt-Anchor" href="#输出格式-2"></a> 输出格式</h4><p>输出包含若干行整数，即为所有操作 2 的结果。</p><h4 id="输入样例-2"><a class="markdownIt-Anchor" href="#输入样例-2"></a> 输入样例<hanla></hanla></h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">5 5<br>1 5 4 2 3<br>2 2 4<br>1 2 3 2<br>2 3 4<br>1 1 5 1<br>2 1 4<br></code></pre></td></tr></tbody></table></figure><h4 id="输出样例-2"><a class="markdownIt-Anchor" href="#输出样例-2"></a> 输出样例<hanla></hanla></h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">11<br>8<br>20<br></code></pre></td></tr></tbody></table></figure><h4 id="题解-2"><a class="markdownIt-Anchor" href="#题解-2"></a> 题解</h4><p>套！！！模！！！板！！！</p><p>注！！！意！！！开！！！<code>long long</code>！！！</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SegTree</span> {<br>	vector&lt;T&gt; datas;<br>	vector&lt;T&gt; lazy_markers;<br>	<span class="hljs-type">size_t</span> length;<br>	<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(vector&lt;T&gt; &amp;d, <span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>    	<span class="hljs-keyword">if</span>(begin == end) {<br>    		datas[node] = d[begin];<br>    	}<br>    	<span class="hljs-keyword">else</span> {<br>    		<span class="hljs-type">size_t</span> mid = (begin + end) / <span class="hljs-number">2</span>;<br>    		<span class="hljs-built_in">build</span>(d, node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, begin, mid);<br>    		<span class="hljs-built_in">build</span>(d, node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, mid + <span class="hljs-number">1</span>, end);<br>    		datas[node] = datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] + datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>];<br>    	}<br>    }<br>    <br>    <span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin_now, <span class="hljs-type">size_t</span> end_now, <span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end)</span> </span>{<br>        <span class="hljs-built_in">push</span>(node, begin_now, end_now);<br>        <span class="hljs-keyword">if</span>(begin_now &gt; end || end_now &lt; begin) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span>(begin_now &gt;= begin &amp;&amp; end_now &lt;= end) <span class="hljs-keyword">return</span> datas[node];<br><br>        <span class="hljs-type">size_t</span> mid = (begin_now + end_now) / <span class="hljs-number">2</span>;<br>        T left_res = <span class="hljs-built_in">query</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, begin_now, mid, begin, end);<br>        T right_res = <span class="hljs-built_in">query</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, mid + <span class="hljs-number">1</span>, end_now, begin, end);<br>        <span class="hljs-keyword">return</span> left_res + right_res;<br>    }<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin_now, <span class="hljs-type">size_t</span> end_now, <span class="hljs-type">size_t</span> begin, <span class="hljs-type">size_t</span> end, T value)</span> </span>{<br>        <span class="hljs-built_in">push</span>(node, begin_now, end_now);<br>        <span class="hljs-keyword">if</span>(begin_now &gt; end || end_now &lt; begin) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-keyword">if</span>(begin_now &gt;= begin &amp;&amp; end_now &lt;= end) {<br>            datas[node] += (end_now - begin_now + <span class="hljs-number">1</span>) * value;<br>            <span class="hljs-keyword">if</span>(begin_now != end_now) {<br>                lazy_markers[node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] += value;<br>                lazy_markers[node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>] += value;<br>            }<br>            <span class="hljs-keyword">return</span>;<br>        }<br><br>        <span class="hljs-type">size_t</span> mid = (begin_now + end_now) / <span class="hljs-number">2</span>;<br>        <span class="hljs-built_in">update</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, begin_now, mid, begin, end, value);<br>        <span class="hljs-built_in">update</span>(node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, mid + <span class="hljs-number">1</span>, end_now, begin, end, value);<br>        datas[node] = datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] + datas[node * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>];<br>    }<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-type">size_t</span> node, <span class="hljs-type">size_t</span> begin_now, <span class="hljs-type">size_t</span> end_now)</span> </span>{<br>        <span class="hljs-keyword">if</span>(lazy_markers[node] != <span class="hljs-number">0</span>) {<br>            datas[node] += (end_now - begin_now + <span class="hljs-number">1</span>) * lazy_markers[node];<br>            <span class="hljs-keyword">if</span>(begin_now != end_now) {<br>                lazy_markers[<span class="hljs-number">2</span> * node + <span class="hljs-number">1</span>] += lazy_markers[node];<br>                lazy_markers[<span class="hljs-number">2</span> * node + <span class="hljs-number">2</span>] += lazy_markers[node];<br>            }<br>            lazy_markers[node] = <span class="hljs-number">0</span>;<br>        }<br>    }<br>    <br>    <span class="hljs-keyword">public</span>:<br>    	<span class="hljs-built_in">SegTree</span>(vector&lt;T&gt; &amp;d) {<br>    		datas.<span class="hljs-built_in">clear</span>();<br>    		lazy_markers.<span class="hljs-built_in">clear</span>();<br>    		length = d.<span class="hljs-built_in">size</span>();<br>    <br>    		datas.<span class="hljs-built_in">resize</span>(length * <span class="hljs-number">4</span>);<br>    		lazy_markers.<span class="hljs-built_in">resize</span>(length * <span class="hljs-number">4</span>, <span class="hljs-number">0</span>);<br>    <br>    		<span class="hljs-built_in">build</span>(d, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, length - <span class="hljs-number">1</span>);<br>    	}<br>    	<br>    	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">size_t</span> l, <span class="hljs-type">size_t</span> r, T value)</span> </span>{<br>            <span class="hljs-built_in">update</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, length - <span class="hljs-number">1</span>, l, r, value);<br>        }<br><br>        <span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">size_t</span> l, <span class="hljs-type">size_t</span> r)</span> </span>{<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, length - <span class="hljs-number">1</span>, l, r);<br>        }<br>};<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> n, m;<br>    cin &gt;&gt; n &gt;&gt; m;<br><br>    <span class="hljs-function">vector&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt; <span class="hljs-title">data</span><span class="hljs-params">(n)</span></span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">long</span> <span class="hljs-type">long</span> &amp;in : data) {<br>        cin &gt;&gt; in;<br>    }<br><br>    <span class="hljs-function">SegTree&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt; <span class="hljs-title">tree</span><span class="hljs-params">(data)</span></span>;<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">long</span> <span class="hljs-type">long</span> turn = <span class="hljs-number">0</span>; turn &lt; m; turn++) {<br>        <span class="hljs-type">long</span> <span class="hljs-type">long</span> opt;<br>        cin &gt;&gt; opt;<br><br>        <span class="hljs-keyword">if</span>(opt == <span class="hljs-number">1</span>) {<br>            <span class="hljs-type">long</span> <span class="hljs-type">long</span> x, y, k;<br>            cin &gt;&gt; x &gt;&gt; y &gt;&gt; k;<br>            x--;<br>            y--;<br>            tree.<span class="hljs-built_in">update</span>(x, y, k);<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-type">long</span> <span class="hljs-type">long</span> x, y;<br>            cin &gt;&gt; x &gt;&gt; y;<br>            x--;<br>            y--;<br>            cout &lt;&lt; tree.<span class="hljs-built_in">query</span>(x, y) &lt;&lt; endl;<br>        }<br>    }<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="题外话"><a class="markdownIt-Anchor" href="#题外话"></a> 题外话</h2><p>把全站所有小节标题由<hanla></hanla><code>h3</code><hanla></hanla>改成<hanla></hanla><code>h2</code><hanla></hanla>了，其它依次上升。</p><p>主要是<hanla></hanla><code>h5</code><hanla></hanla>比正文还小了。</p><p>以及总算是一知半解（？）地弄会了线段树。</p><p>这下可以做绿题（？）了哈哈。</p><h2 id="注释"><a class="markdownIt-Anchor" href="#注释"></a> 注释</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>本文内的除法均为整数除法。 <a href="#fnref:1" rev="footnote" class="footnote-backref">↩</a></span></span></li></ol></div></section></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E7%BC%96%E7%A8%8B/" class="category-chain-item">编程</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="print-no-link">#计算机</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" class="print-no-link">#编程</a> <a href="/tags/cpp/" class="print-no-link">#cpp</a></div></div><div class="license-box my-3"><div class="license-title"><div><hanla></hanla>学习笔记——分块、线段树<hanla></hanla></div><div>https://www.ordchaos.com/posts/6e841aef/</div></div><div class="license-meta"><div class="license-meta-item"><div><hanla></hanla>作者</div><div>序炁</div></div><div class="license-meta-item license-meta-date"><div>发布于<hanla></hanla></div><div>2024<hanla></hanla>年<hanla></hanla>8<hanla></hanla>月<hanla></hanla>5<hanla></hanla>日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="/go.html?url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8=" rel="external nofollow noopener noreferrer"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-ordchaos-blog-copyright-by"></i> </span></a><a class="print-no-link" target="_blank" href="/go.html?url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8=" rel="external nofollow noopener noreferrer"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-ordchaos-blog-copyright-nc"></i> </span></a><a class="print-no-link" target="_blank" href="/go.html?url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8=" rel="external nofollow noopener noreferrer"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-ordchaos-blog-copyright-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><script type="module" src="/js/emaction-bundle.js"></script><emoji-reaction emoji-reaction="" availablearraystring="👍,thumbs-up;😄,smile-face;🎉,party-popper;" endpoint="https://api-emaction.ordchaos.top"></emoji-reaction><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/fd9dafa1/" title="无服务器AI摘要后端——OrdChaosGPT"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">无服务器<hanla></hanla>AI<hanla></hanla>摘要后端——OrdChaosGPT</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/8752b65a/" title="学习笔记——STL模板库之数据结构"><span class="hidden-mobile">学习笔记——STL<hanla></hanla>模板库之数据结构</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="twikoo"></div><script type="text/javascript">Fluid.utils.loadComments("#comments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/twikoo/1.6.38/twikoo.all.min.js",(function(){var o=Object.assign({envId:"https://twikoo.ordchaos.top",region:null,path:"window.location.pathname"},{el:"#twikoo",path:"window.location.pathname",onCommentLoaded:function(){Fluid.utils.listenDOMLoaded((function(){var o="#twikoo .tk-content img:not(.tk-owo-emotion)";Fluid.plugins.imageCaption(o),Fluid.plugins.fancyBox(o)}))}});twikoo.init(o)}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script src="/js/aisummary.js"></script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索<hanla></hanla></h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://www.ordchaos.com" target="_blank" rel="nofollow noopener"><span>序炁<hanla></hanla>OrderChaos(OrdChaos)</span></a><span> ©2020 ~ 现在</span><br><a href="https://www.ordchaos.com/privacy/" target="_blank">隐私政策</a>·<a href="https://www.ordchaos.com/cookies/" target="_blank">Cookies<hanla></hanla>政策</a>·<a href="https://www.ordchaos.com/copyright/" target="_blank">版权政策</a><br>由<hanla></hanla><a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a><hanla></hanla>引擎强力驱动 | 由<hanla></hanla><a href="https://hexo.fluid-dev.com/" target="_blank" rel="external nofollow noopener noreferrer">Fluid</a><hanla></hanla>主题鼎力支持 | 由<a href="https://www.ordchaos.com/" target="_blank">序炁</a><del>呕心沥血</del>创作 | 已加入<a href="https://www.travellings.cn/" target="_blank" rel="external nofollow noopener noreferrer">开往</a>·<a href="https://www.foreverblog.cn/blog/3448.html" target="_blank" rel="external nofollow noopener noreferrer">十年之约</a>·<a href="https://www.boyouquan.com/blogs/www.ordchaos.com" target="_blank" rel="external nofollow noopener noreferrer">博友圈</a><div style="font-size:1rem">自<hanla></hanla>2022.1.1<hanla></hanla>建站以来 , 本站已安全运行<span id="timeDate">「待载期之」</span> , 受<span id="uvStatic">「数待载之」</span>人共<span id="pvStatic">「数待载之」</span>次访问</div><a href="https://out.ordchaos.com/travellings" target="_blank" rel="external nofollow noopener noreferrer" title="开往-友链接力"><img src="https://img.ordchaos.com/img/2022/08/33f94042a3ad2bf8bb5ece7b9cc146d6.gif" srcset="/img/loading.gif" lazyload alt="开往-友链接力" width="120"> </a><a href="https://out.ordchaos.com/wormhole" target="_blank" title="穿梭虫洞-随机访问十年之约友链博客" rel="external nofollow noopener noreferrer"><img src="https://img.ordchaos.com/img/2022/08/d4a803e55c25cdff51e507e937b5b701.gif" srcset="/img/loading.gif" lazyload alt="穿梭虫洞-随机访问十年之约友链博客" style="width:120px;height:auto"> </a><a href="https://www.boyouquan.com/planet-shuttle" target="_blank" title="博友圈-博客人的朋友圈，博客收录与文章 RSS 聚合网站" rel="external nofollow noopener noreferrer"><img src="https://img.ordchaos.com/img/2024/08/1d3df4a92aab4df7e42626b7c79e4238.png" srcset="/img/loading.gif" lazyload alt="星球穿梭" style="width:120px;height:auto"> </a><span class="bo_icon_space"></span> <a href="https://notbyai.fyi/" target="_blank" title="非AI撰写" rel="external nofollow noopener noreferrer"><img src="https://www.ordchaos.com/img/Written-By-Human-Not-By-AI-Badge-white.svg" srcset="/img/loading.gif" lazyload alt="Written by Human, Not by AI" style="width:120px;height:auto"></a><br><a href="https://icp.gov.moe/?keyword=20220824" target="_blank" rel="external nofollow noopener noreferrer">萌<hanla></hanla>ICP<hanla></hanla>备<hanla></hanla>20220824<hanla></hanla>号<hanla></hanla></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer="" src="/js/umami-view.js"></script><script src="/js/jump.js"></script><script src="/js/tw_cn_tran.js"></script><script src="/js/duration.js"></script><script src="/js/rand.js"></script><script src="/js/jquery.min.js"></script><script src="/js/moment.min.js"></script><script src="/js/canvas-nest-mouse.min.js"></script><script src="/js/umami.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning"><hanla></hanla>博客在允许 JavaScript 运行的环境下浏览效果更佳<hanla></hanla></div></noscript></body></html>